name: 'ðŸ§ª Test Normalize Arguments'

on:
  push:
    paths:
      - 'normalize-arguments/**'
      - '.github/workflows/test-normalize-arguments.yml'
  pull_request:
    paths:
      - 'normalize-arguments/**'
      - '.github/workflows/test-normalize-arguments.yml'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  test:
    name: 'Test on ${{ matrix.os }}'
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v4

      - name: 'Test single-line'
        id: test1
        uses: ./normalize-arguments
        with:
          arguments: '--verbose --config Release'

      - name: 'Verify single-line'
        shell: bash
        run: |
          RESULT="${{ steps.test1.outputs.normalized }}"
          echo "Result: '$RESULT'"
          [[ "$RESULT" == "--verbose --config Release" ]] || exit 1

      - name: 'Test multi-line'
        id: test2
        uses: ./normalize-arguments
        with:
          arguments: |
            --env
            "NODE_ENV=prod"
            --port
            "3000"

      - name: 'Verify multi-line'
        shell: bash
        env:
          RESULT: ${{ steps.test2.outputs.normalized }}
        run: |
          echo "Result: '$RESULT'"
          [[ "$RESULT" == '--env "NODE_ENV=prod" --port "3000"' ]] || exit 1

      - name: 'Test empty'
        id: test3
        uses: ./normalize-arguments
        with:
          arguments: ''

      - name: 'Verify empty'
        shell: bash
        run: |
          RESULT="${{ steps.test3.outputs.normalized }}"
          echo "Result: '$RESULT'"
          [[ -z "$RESULT" ]] || exit 1

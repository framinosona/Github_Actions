name: 'ðŸ§ª Test Normalize Path'

on:
  push:
    paths:
      - 'normalize-path/**'
      - '.github/workflows/test-normalize-path.yml'
  pull_request:
    paths:
      - 'normalize-path/**'
      - '.github/workflows/test-normalize-path.yml'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  test:
    name: 'Test on ${{ matrix.os }}'
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v6

      - name: 'Create test file'
        shell: bash
        run: |
          mkdir -p test-dir
          echo "test" > test-dir/test-file.txt

      - name: 'Test file path'
        id: test1
        uses: ./normalize-path
        with:
          path: 'test-dir/test-file.txt'

      - name: 'Verify file path'
        shell: bash
        run: |
          NORMALIZED="${{ steps.test1.outputs.normalized }}"
          EXISTS="${{ steps.test1.outputs.exists }}"
          echo "Normalized: '$NORMALIZED'"
          echo "Exists: '$EXISTS'"
          [[ "$EXISTS" == "true" ]] || exit 1

      - name: 'Test with backslashes'
        id: test2
        uses: ./normalize-path
        with:
          path: 'test-dir\test-file.txt'

      - name: 'Verify backslashes'
        shell: bash
        run: |
          NORMALIZED="${{ steps.test2.outputs.normalized }}"
          EXISTS="${{ steps.test2.outputs.exists }}"
          echo "Normalized: '$NORMALIZED'"
          echo "Exists: '$EXISTS'"
          [[ "$EXISTS" == "true" ]] || exit 1

      - name: 'Test non-existent'
        id: test3
        uses: ./normalize-path
        with:
          path: 'does-not-exist.txt'

      - name: 'Verify non-existent'
        shell: bash
        run: |
          EXISTS="${{ steps.test3.outputs.exists }}"
          echo "Exists: '$EXISTS'"
          [[ "$EXISTS" == "false" ]] || exit 1
